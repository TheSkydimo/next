(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[183],{9201:function(e,t,n){Promise.resolve().then(n.bind(n,76))},76:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return i}});var l=n(7437),s=n(2265),r=n(7138);function i(){var e;let[t,n]=(0,s.useState)(null),[i,a]=(0,s.useState)(!0),[o,d]=(0,s.useState)(null),[c,u]=(0,s.useState)(""),[p,h]=(0,s.useState)(!1),[y,j]=(0,s.useState)(null),[g,x]=(0,s.useState)(null),[f,m]=(0,s.useState)(""),[v,S]=(0,s.useState)(""),[b,T]=(0,s.useState)(""),[w,E]=(0,s.useState)(null),[C,O]=(0,s.useState)(null),[k,N]=(0,s.useState)(!1),[R,q]=(0,s.useState)(""),[P,_]=(0,s.useState)(""),[D,I]=(0,s.useState)("REQUEST"),[K,A]=(0,s.useState)(""),[F,J]=(0,s.useState)(""),[Q,U]=(0,s.useState)(null),[W,V]=(0,s.useState)(null),[z,H]=(0,s.useState)(!1);async function Y(e){e.preventDefault(),x(null),j(null),h(!0);try{let e=await fetch("/api/account/profile",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:c.trim()||void 0})}),a=await e.json();if(!e.ok||"OK"!==a.code){let e=a.message;if(!e&&"VALIDATION_ERROR"===a.code&&a.errors){var t,l,s,r,i;let n=a.errors;e=null!==(i=null!==(r=null===(l=n.fieldErrors)||void 0===l?void 0:null===(t=l.name)||void 0===t?void 0:t[0])&&void 0!==r?r:null===(s=n.formErrors)||void 0===s?void 0:s[0])&&void 0!==i?i:""}x(e||"更新资料失败");return}a.data&&n(a.data),j("资料已更新")}catch(e){console.error(e),x("网络错误，请稍后重试")}finally{h(!1)}}async function G(e){if(e.preventDefault(),O(null),E(null),v!==b){O("两次输入的新密码不一致");return}N(!0);try{let e=await fetch("/api/account/password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPassword:f,newPassword:v})}),n=await e.json();if(!e.ok||"OK"!==n.code){var t;O(null!==(t=n.message)&&void 0!==t?t:"修改密码失败");return}E("密码修改成功"),m(""),S(""),T("")}catch(e){console.error(e),O("网络错误，请稍后重试")}finally{N(!1)}}async function L(e){if(e.preventDefault(),V(null),U(null),!P.trim()){V("请输入新邮箱");return}H(!0);try{let e=await fetch("/api/account/email/request-change",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({newEmail:P.trim(),currentPassword:R})}),n=await e.json();if(!e.ok||"OK"!==n.code){var t;V(null!==(t=n.message)&&void 0!==t?t:"请求修改邮箱失败");return}J(P.trim()),I("VERIFY"),U("验证码已发送至新邮箱，请查收并填写验证码完成修改")}catch(e){console.error(e),V("网络错误，请稍后重试")}finally{H(!1)}}async function M(e){if(e.preventDefault(),V(null),U(null),!F){V("缺少待修改的新邮箱信息，请重新发起邮箱变更请求");return}if(!K.trim()){V("请输入邮箱中的验证码");return}H(!0);try{let e=await fetch("/api/account/email/confirm-change",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({newEmail:F,code:K.trim()})}),l=await e.json();if(!e.ok||"OK"!==l.code){var t;V(null!==(t=l.message)&&void 0!==t?t:"邮箱修改失败");return}l.data&&n(l.data),U("邮箱修改成功"),I("REQUEST"),q(""),_(""),A(""),J("")}catch(e){console.error(e),V("网络错误，请稍后重试")}finally{H(!1)}}return(0,s.useEffect)(()=>{let e=!1;return async function(){try{var t,l;a(!0),d(null);let s=await fetch("/api/account/me",{method:"GET",headers:{"Content-Type":"application/json"}});if(401===s.status){e||d("未登录，请先登录");return}let r=await s.json();if(!s.ok||"OK"!==r.code||!r.data){e||d(null!==(t=r.message)&&void 0!==t?t:"获取用户信息失败");return}e||(n(r.data),u(null!==(l=r.data.name)&&void 0!==l?l:""))}catch(t){e||d("网络错误，请稍后重试")}finally{e||a(!1)}}(),()=>{e=!0}},[]),(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{children:"基本信息"}),i&&(0,l.jsx)("p",{children:"加载中..."}),!i&&o&&(0,l.jsxs)("p",{style:{color:"red",marginTop:16},children:[o,o.includes("未登录")&&(0,l.jsxs)(l.Fragment,{children:[" ",(0,l.jsx)(r.default,{href:"/login",children:"去登录"})]})]}),!i&&t&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("section",{style:{marginTop:24},children:[(0,l.jsx)("h2",{children:"账户概览"}),(0,l.jsxs)("div",{style:{marginTop:12,lineHeight:1.8},children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("strong",{children:"当前邮箱："}),t.email]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("strong",{children:"昵称："}),null!==(e=t.name)&&void 0!==e?e:"未设置"]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("strong",{children:"角色："}),"ADMIN"===t.role?"管理员":"普通用户"]})]})]}),(0,l.jsxs)("section",{style:{marginTop:32},children:[(0,l.jsx)("h2",{children:"修改昵称"}),(0,l.jsxs)("form",{onSubmit:Y,style:{marginTop:12,display:"grid",gap:12,maxWidth:400},children:[(0,l.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,l.jsx)("span",{children:"昵称"}),(0,l.jsx)("input",{value:c,onChange:e=>u(e.target.value),placeholder:"请输入新的昵称"})]}),(0,l.jsx)("button",{type:"submit",disabled:p,children:p?"保存中...":"保存"}),g&&(0,l.jsx)("p",{style:{color:"red"},children:g}),y&&(0,l.jsx)("p",{style:{color:"green"},children:y})]})]}),(0,l.jsxs)("section",{style:{marginTop:32},children:[(0,l.jsx)("h2",{children:"修改密码"}),(0,l.jsxs)("form",{onSubmit:G,style:{marginTop:12,display:"grid",gap:12,maxWidth:400},children:[(0,l.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,l.jsx)("span",{children:"当前密码"}),(0,l.jsx)("input",{type:"password",value:f,onChange:e=>m(e.target.value),required:!0})]}),(0,l.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,l.jsx)("span",{children:"新密码"}),(0,l.jsx)("input",{type:"password",value:v,onChange:e=>S(e.target.value),required:!0})]}),(0,l.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,l.jsx)("span",{children:"确认新密码"}),(0,l.jsx)("input",{type:"password",value:b,onChange:e=>T(e.target.value),required:!0})]}),(0,l.jsx)("button",{type:"submit",disabled:k,children:k?"修改中...":"修改密码"}),C&&(0,l.jsx)("p",{style:{color:"red"},children:C}),w&&(0,l.jsx)("p",{style:{color:"green"},children:w})]})]}),(0,l.jsxs)("section",{style:{marginTop:32},children:[(0,l.jsx)("h2",{children:"修改邮箱"}),"REQUEST"===D&&(0,l.jsxs)("form",{onSubmit:L,style:{marginTop:12,display:"grid",gap:12,maxWidth:400},children:[(0,l.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,l.jsx)("span",{children:"新邮箱"}),(0,l.jsx)("input",{type:"email",value:P,onChange:e=>_(e.target.value),required:!0,placeholder:"请输入新的登录邮箱"})]}),(0,l.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,l.jsx)("span",{children:"当前密码（用于安全验证）"}),(0,l.jsx)("input",{type:"password",value:R,onChange:e=>q(e.target.value),required:!0})]}),(0,l.jsx)("button",{type:"submit",disabled:z,children:z?"提交中...":"发送验证码到新邮箱"}),W&&(0,l.jsx)("p",{style:{color:"red"},children:W}),Q&&(0,l.jsx)("p",{style:{color:"green"},children:Q})]}),"VERIFY"===D&&(0,l.jsxs)("form",{onSubmit:M,style:{marginTop:12,display:"grid",gap:12,maxWidth:400},children:[(0,l.jsxs)("p",{style:{fontSize:14,color:"#555"},children:["我们已向 ",(0,l.jsx)("strong",{children:F})," 发送了验证码，请填写 6 位数字验证码完成邮箱修改。"]}),(0,l.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,l.jsx)("span",{children:"验证码"}),(0,l.jsx)("input",{value:K,onChange:e=>A(e.target.value),placeholder:"请输入新邮箱中的验证码",required:!0})]}),(0,l.jsx)("button",{type:"submit",disabled:z,children:z?"提交中...":"确认修改邮箱"}),(0,l.jsx)("button",{type:"button",onClick:()=>{I("REQUEST"),V(null),U(null),A(""),J("")},style:{fontSize:13},children:"返回重新填写"}),W&&(0,l.jsx)("p",{style:{color:"red"},children:W}),Q&&(0,l.jsx)("p",{style:{color:"green"},children:Q})]})]})]})]})}},7138:function(e,t,n){"use strict";n.d(t,{default:function(){return s.a}});var l=n(231),s=n.n(l)}},function(e){e.O(0,[231,971,23,744],function(){return e(e.s=9201)}),_N_E=e.O()}]);