(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[278],{4252:function(e,t,n){Promise.resolve().then(n.bind(n,875))},875:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return a}});var i=n(7437),r=n(2265),s=n(7648);function a(){let[e,t]=(0,r.useState)([]),[n,a]=(0,r.useState)(!0),[c,d]=(0,r.useState)(null),[l,o]=(0,r.useState)(null);async function u(e){if("PENDING"===e.status&&window.confirm("确定要取消订单「".concat(e.orderNo,"」吗？取消后需要重新下单才能继续支付。")))try{o(e.id),d(null);let i=await fetch("/api/account/orders/".concat(e.id,"/cancel"),{method:"POST"}),r=await i.json().catch(()=>({code:"UNKNOWN_ERROR"}));if(!i.ok||"OK"!==r.code){var n;d(null!==(n=r.message)&&void 0!==n?n:"取消订单失败，请稍后重试");return}t(t=>t.map(t=>t.id===e.id?{...t,status:"CANCELED"}:t))}catch(e){d("网络错误，取消订单失败，请稍后重试")}finally{o(null)}}async function f(e){if("PAID"===e.status&&window.confirm("确定要为订单「".concat(e.orderNo,"」申请退款吗？提交后将由管理员审核。")))try{o(e.id),d(null);let i=await fetch("/api/account/orders/".concat(e.id,"/refund-request"),{method:"POST"}),r=await i.json().catch(()=>({code:"UNKNOWN_ERROR"}));if(!i.ok||"OK"!==r.code){var n;d(null!==(n=r.message)&&void 0!==n?n:"申请退款失败，请稍后重试");return}t(t=>t.map(t=>t.id===e.id?{...t,status:"REFUND_REQUESTED"}:t))}catch(e){d("网络错误，申请退款失败，请稍后重试")}finally{o(null)}}return(0,r.useEffect)(()=>{let e=!1;return async function(){try{a(!0),d(null);let i=await fetch("/api/account/orders",{method:"GET",headers:{"Content-Type":"application/json"}});if(401===i.status){e||d("未登录，请先登录");return}let r=await i.json();if(!i.ok||"OK"!==r.code||!r.data){if(!e){var n;d(null!==(n=r.message)&&void 0!==n?n:"获取订单列表失败")}return}e||t(r.data)}catch(t){e||d("网络错误，请稍后重试")}finally{e||a(!1)}}(),()=>{e=!0}},[]),(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{children:"订单信息"}),n&&(0,i.jsx)("p",{children:"加载中..."}),!n&&c&&(0,i.jsxs)("p",{style:{color:"red",marginTop:16},children:[c,c.includes("未登录")&&(0,i.jsxs)(i.Fragment,{children:[" ",(0,i.jsx)(s.default,{href:"/login",children:"去登录"})]})]}),!n&&!c&&0===e.length&&(0,i.jsx)("p",{style:{marginTop:24},children:"暂无订单"}),!n&&!c&&e.length>0&&(0,i.jsxs)("section",{style:{marginTop:24},children:[(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1.5fr",fontWeight:600,padding:"8px 0",borderBottom:"1px solid #ddd",fontSize:14},children:[(0,i.jsx)("span",{children:"订单信息"}),(0,i.jsx)("span",{children:"金额"}),(0,i.jsx)("span",{children:"状态"}),(0,i.jsx)("span",{children:"时间"})]}),e.map(e=>(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1.5fr",padding:"10px 0",borderBottom:"1px solid #f0f0f0",fontSize:14},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{children:(0,i.jsx)("strong",{children:e.planName})}),(0,i.jsxs)("div",{style:{color:"#555",marginTop:4},children:["订单号：",e.orderNo]}),(0,i.jsxs)("div",{style:{color:"#555",marginTop:2},children:["支付渠道：",function(e){switch(e){case"ALIPAY":return"支付宝";case"WECHAT":return"微信支付";case"STRIPE":return"Stripe";case"PAYPAL":return"PayPal";default:return e}}(e.paymentChannel)]})]}),(0,i.jsxs)("div",{children:[e.amount," ",e.currency]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{children:function(e){switch(e){case"PENDING":return"待支付";case"PAID":return"已支付";case"CANCELED":return"已取消";case"REFUND_REQUESTED":return"退款申请中";case"REFUNDED":return"已退款";default:return e}}(e.status)}),"PENDING"===e.status&&(0,i.jsx)("button",{type:"button",style:{marginTop:8,fontSize:12},disabled:l===e.id,onClick:()=>void u(e),children:"取消订单"}),"PAID"===e.status&&(0,i.jsx)("button",{type:"button",style:{marginTop:8,fontSize:12},disabled:l===e.id,onClick:()=>void f(e),children:"申请退款"}),"REFUND_REQUESTED"===e.status&&(0,i.jsx)("div",{style:{marginTop:8,fontSize:12,color:"#c67"},children:"已提交退款申请，等待管理员处理"})]}),(0,i.jsxs)("div",{style:{color:"#555"},children:[(0,i.jsxs)("div",{children:["创建：",new Date(e.createdAt).toLocaleString()]}),e.paidAt&&(0,i.jsxs)("div",{style:{marginTop:2},children:["支付：",new Date(e.paidAt).toLocaleString()]})]})]},e.id))]})]})}},7648:function(e,t,n){"use strict";n.d(t,{default:function(){return r.a}});var i=n(2972),r=n.n(i)}},function(e){e.O(0,[972,971,117,744],function(){return e(e.s=4252)}),_N_E=e.O()}]);