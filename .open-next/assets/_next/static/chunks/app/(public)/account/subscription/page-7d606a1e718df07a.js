(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[995],{2300:function(e,n,i){Promise.resolve().then(i.bind(i,489))},489:function(e,n,i){"use strict";i.r(n),i.d(n,{default:function(){return d}});var t=i(7437),r=i(2265),s=i(7138);function l(e){switch(e){case"ACTIVE":return"生效中";case"CANCELED":return"已取消";case"EXPIRED":return"已过期";default:return e}}function c(e){switch(e){case"MONTHLY":return"按月";case"QUARTERLY":return"按季度";case"YEARLY":return"按年";default:return e}}function d(){let[e,n]=(0,r.useState)(null),[i,d]=(0,r.useState)([]),[a,o]=(0,r.useState)(!0),[h,u]=(0,r.useState)(null),[p,x]=(0,r.useState)([]),[f,g]=(0,r.useState)(!1),[j,y]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let e=!1;return async function(){try{o(!0),u(null);let t=await fetch("/api/account/subscriptions",{method:"GET",headers:{"Content-Type":"application/json"}});if(401===t.status){e||u("未登录，请先登录");return}let r=await t.json();if(!t.ok||"OK"!==r.code||!r.data){if(!e){var i;u(null!==(i=r.message)&&void 0!==i?i:"获取订阅信息失败")}return}e||(n(r.data.current),d(r.data.history))}catch(n){e||u("网络错误，请稍后重试")}finally{e||o(!1)}}(),()=>{e=!0}},[]),(0,r.useEffect)(()=>{let e=!1;return async function(){try{g(!0),y(null);let n=await fetch("/api/membership/plans",{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok){e||y("获取套餐列表失败");return}let i=await n.json();e||x(i)}catch(n){e||y("网络错误，获取套餐列表失败")}finally{e||g(!1)}}(),()=>{e=!0}},[]),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{children:"订阅信息"}),a&&(0,t.jsx)("p",{children:"加载中..."}),!a&&h&&(0,t.jsxs)("p",{style:{color:"red",marginTop:16},children:[h,h.includes("未登录")&&(0,t.jsxs)(t.Fragment,{children:[" ",(0,t.jsx)(s.default,{href:"/login",children:"去登录"})]})]}),!a&&!h&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("section",{style:{marginTop:24},children:[(0,t.jsx)("h2",{children:"当前订阅"}),!e&&(0,t.jsx)("p",{style:{marginTop:12},children:"当前没有生效中的订阅"}),e&&(0,t.jsxs)("div",{style:{marginTop:12,padding:16,border:"1px solid #ddd",borderRadius:4,lineHeight:1.8},children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:e.planName}),(0,t.jsxs)("span",{style:{marginLeft:8,color:"#666",fontSize:14},children:["(",c(e.billingCycle)," /"," ",e.price," ",e.currency,")"]})]}),e.planDescription&&(0,t.jsx)("div",{style:{marginTop:4,color:"#555"},children:e.planDescription}),(0,t.jsxs)("div",{style:{marginTop:8},children:[(0,t.jsx)("strong",{children:"状态："}),l(e.status)]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"生效时间："}),new Date(e.startAt).toLocaleString()]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"到期时间："}),new Date(e.endAt).toLocaleString()]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"自动续费："}),e.autoRenew?"已开启":"未开启"]})]})]}),(0,t.jsxs)("section",{style:{marginTop:32},children:[(0,t.jsx)("h2",{children:"订阅历史"}),0===i.length&&(0,t.jsx)("p",{style:{marginTop:12},children:"暂无订阅记录"}),i.length>0&&(0,t.jsx)("div",{style:{marginTop:12},children:i.map(e=>(0,t.jsxs)("div",{style:{padding:"12px 0",borderBottom:"1px solid #f0f0f0",fontSize:14,lineHeight:1.7},children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:e.planName}),(0,t.jsxs)("span",{style:{marginLeft:8,color:"#666",fontSize:13},children:["(",c(e.billingCycle)," / ",e.price," ",e.currency,")"]})]}),(0,t.jsxs)("div",{children:["状态：",l(e.status),"｜自动续费：",e.autoRenew?"已开启":"未开启"]}),(0,t.jsxs)("div",{children:["生效：",new Date(e.startAt).toLocaleString()," ｜ 到期：",new Date(e.endAt).toLocaleString()]})]},e.id))})]}),(0,t.jsxs)("section",{style:{marginTop:32},children:[(0,t.jsx)("h2",{children:"选择 / 变更订阅套餐"}),(0,t.jsx)("p",{style:{marginTop:8,color:"#555",fontSize:14},children:"你也可以在这里直接选择需要的套餐，系统会跳转到结算页并为当前账号创建订单。"}),f&&(0,t.jsx)("p",{style:{marginTop:12},children:"套餐加载中..."}),!f&&j&&(0,t.jsx)("p",{style:{marginTop:12,color:"red"},children:j}),!f&&!j&&0===p.length&&(0,t.jsx)("p",{style:{marginTop:12},children:"暂无可用套餐，请联系管理员配置。"}),!f&&!j&&p.length>0&&(0,t.jsx)("div",{style:{marginTop:16,display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:16},children:p.map(e=>(0,t.jsxs)("div",{style:{border:"1px solid #ddd",borderRadius:6,padding:16,fontSize:14,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{fontWeight:600,marginBottom:4},children:e.name}),(0,t.jsxs)("div",{children:[e.price/100," ",e.currency," /"," ",c(e.billingCycle)]}),e.description&&(0,t.jsx)("div",{style:{marginTop:6,color:"#555",lineHeight:1.6},children:e.description})]}),(0,t.jsx)("div",{style:{marginTop:12},children:(0,t.jsx)(s.default,{href:"/checkout?planId=".concat(e.id),style:{display:"inline-block",padding:"6px 12px",borderRadius:4,backgroundColor:"#000",color:"#fff",textDecoration:"none"},children:"订阅 / 切换到此套餐"})})]},e.id))})]})]})]})}},7138:function(e,n,i){"use strict";i.d(n,{default:function(){return r.a}});var t=i(231),r=i.n(t)}},function(e){e.O(0,[231,971,23,744],function(){return e(e.s=2300)}),_N_E=e.O()}]);