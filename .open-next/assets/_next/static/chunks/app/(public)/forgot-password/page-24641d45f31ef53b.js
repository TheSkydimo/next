(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[202],{9958:function(e,t,n){Promise.resolve().then(n.bind(n,8762))},8762:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return l}});var s=n(7437),a=n(2265),r=n(7138),i=n(6463);function l(){let e=(0,i.useRouter)(),[t,n]=(0,a.useState)("REQUEST"),[l,u]=(0,a.useState)(""),[o,d]=(0,a.useState)(""),[c,p]=(0,a.useState)(""),[h,g]=(0,a.useState)(""),[y,f]=(0,a.useState)(!1),[x,m]=(0,a.useState)(null),[j,S]=(0,a.useState)(null),[b,v]=(0,a.useState)(!1),[w,T]=(0,a.useState)(!1);async function C(e){if(e.preventDefault(),m(null),S(null),!l.trim()){m("请输入邮箱");return}f(!0);try{var t,s;let e=await fetch("/api/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:l})}),a=await e.json().catch(()=>({}));if(!e.ok){m(null!==(t=a.message)&&void 0!==t?t:"发送重置邮件失败");return}S(null!==(s=a.message)&&void 0!==s?s:"如果该邮箱已注册，我们会发送一封包含激活码的邮件，请按邮件提示操作。"),n("RESET")}catch(e){m("网络错误，请稍后重试")}finally{f(!1)}}async function E(t){if(t.preventDefault(),m(null),S(null),!o.trim()){m("请输入激活码");return}if(c!==h){m("两次输入的新密码不一致");return}f(!0);try{let t=await fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:l,code:o.trim(),newPassword:c})}),s=await t.json().catch(()=>({}));if(!t.ok||"OK"!==s.code){var n;m(null!==(n=s.message)&&void 0!==n?n:"重置密码失败");return}S("密码重置成功，已自动登录，正在跳转到登录页..."),setTimeout(()=>{e.push("/login")},1e3)}catch(e){m("网络错误，请稍后重试")}finally{f(!1)}}return(0,s.jsxs)("main",{style:{maxWidth:400,margin:"40px auto",padding:"0 16px"},children:[(0,s.jsx)("h1",{children:"找回密码"}),"REQUEST"===t&&(0,s.jsxs)("form",{onSubmit:C,style:{display:"grid",gap:12,marginTop:16},children:[(0,s.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,s.jsx)("span",{children:"注册邮箱"}),(0,s.jsx)("input",{type:"email",value:l,onChange:e=>u(e.target.value),required:!0})]}),(0,s.jsx)("button",{type:"submit",disabled:y,children:y?"发送中...":"发送激活码到邮箱"}),x&&(0,s.jsx)("p",{style:{color:"red"},children:x}),j&&(0,s.jsx)("p",{style:{color:"green"},children:j})]}),"RESET"===t&&(0,s.jsxs)("form",{onSubmit:E,style:{display:"grid",gap:12,marginTop:24},children:[(0,s.jsxs)("p",{style:{fontSize:14,color:"#555"},children:["我们已向 ",(0,s.jsx)("strong",{children:l})," 发送了激活码。请填写激活码并设置新的登录密码。"]}),(0,s.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,s.jsx)("span",{children:"激活码"}),(0,s.jsx)("input",{value:o,onChange:e=>d(e.target.value),required:!0})]}),(0,s.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,s.jsx)("span",{children:"新密码"}),(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[(0,s.jsx)("input",{type:b?"text":"password",value:c,onChange:e=>p(e.target.value),required:!0}),(0,s.jsx)("button",{type:"button",onClick:()=>v(e=>!e),style:{fontSize:12,padding:"4px 8px",whiteSpace:"nowrap"},children:b?"隐藏密码":"显示密码"})]})]}),(0,s.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,s.jsx)("span",{children:"确认新密码"}),(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[(0,s.jsx)("input",{type:w?"text":"password",value:h,onChange:e=>g(e.target.value),required:!0}),(0,s.jsx)("button",{type:"button",onClick:()=>T(e=>!e),style:{fontSize:12,padding:"4px 8px",whiteSpace:"nowrap"},children:w?"隐藏密码":"显示密码"})]})]}),(0,s.jsx)("button",{type:"submit",disabled:y,children:y?"重置中...":"提交重置"}),x&&(0,s.jsx)("p",{style:{color:"red"},children:x}),j&&(0,s.jsx)("p",{style:{color:"green"},children:j})]}),(0,s.jsxs)("p",{style:{marginTop:16},children:["已记起密码？ ",(0,s.jsx)(r.default,{href:"/login",children:"返回登录"})]})]})}},7138:function(e,t,n){"use strict";n.d(t,{default:function(){return a.a}});var s=n(231),a=n.n(s)},6463:function(e,t,n){"use strict";var s=n(1169);n.o(s,"usePathname")&&n.d(t,{usePathname:function(){return s.usePathname}}),n.o(s,"useRouter")&&n.d(t,{useRouter:function(){return s.useRouter}}),n.o(s,"useSearchParams")&&n.d(t,{useSearchParams:function(){return s.useSearchParams}})}},function(e){e.O(0,[231,971,23,744],function(){return e(e.s=9958)}),_N_E=e.O()}]);