(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[782],{2884:function(e,t,n){Promise.resolve().then(n.bind(n,9357))},9357:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return u}});var s=n(7437),r=n(2265),l=n(7138),a=n(6463),i=n(7668);function u(){let e=(0,a.useRouter)(),[t,n]=(0,r.useState)(""),[u,o]=(0,r.useState)(""),[d,p]=(0,r.useState)(""),[c,h]=(0,r.useState)(""),[g,y]=(0,r.useState)(!1),[f,x]=(0,r.useState)(!1),[m,j]=(0,r.useState)(""),[v,S]=(0,r.useState)(""),[b,C]=(0,r.useState)(!1),[w,E]=(0,r.useState)(null),[R,T]=(0,r.useState)(null),[I,k]=(0,r.useState)("REGISTER"),[P,O]=(0,r.useState)(""),[N,_]=(0,r.useState)("");function q(){j((0,i.y)()),S("")}async function D(e){if(e.preventDefault(),E(null),T(null),d!==c){E("两次输入的密码不一致");return}if(v.trim().toUpperCase()!==m.toUpperCase()){E("验证码错误"),q();return}C(!0);try{var n,s,r;let e=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:d,name:u})}),l=await e.json().catch(()=>({}));if(e.ok)"VERIFICATION_REQUIRED"===l.code?(O(t),k("VERIFY"),T("注册信息已提交，请查看邮箱验证码并完成激活")):T(null!==(r=l.message)&&void 0!==r?r:"注册成功");else{let e=l.message;if(!e&&"VALIDATION_ERROR"===l.code&&l.errors){let t=l.errors.fieldErrors,r=l.errors.formErrors;e=(null==t?void 0:null===(n=t.password)||void 0===n?void 0:n[0])||(null==t?void 0:null===(s=t.email)||void 0===s?void 0:s[0])||(null==r?void 0:r[0])}E(null!=e?e:"注册失败")}}catch(e){E("网络错误，请稍后重试")}finally{C(!1)}}async function F(t){if(t.preventDefault(),E(null),T(null),!P){E("缺少待激活的邮箱信息，请重新注册。");return}if(!N.trim()){E("请输入邮箱中的激活码");return}C(!0);try{let t=await fetch("/api/auth/verify-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:P,code:N.trim()})}),s=await t.json().catch(()=>({}));if(t.ok)T("邮箱激活成功，已自动登录，将跳转到登录页..."),setTimeout(()=>{e.push("/login")},1e3);else{var n;E(null!==(n=s.message)&&void 0!==n?n:"激活失败，请稍后重试")}}catch(e){E("网络错误，请稍后重试")}finally{C(!1)}}return(0,r.useEffect)(()=>{q()},[]),(0,s.jsxs)("main",{style:{maxWidth:400,margin:"40px auto",padding:"0 16px"},children:[(0,s.jsx)("h1",{children:"注册"}),"REGISTER"===I&&(0,s.jsxs)("form",{onSubmit:D,style:{display:"grid",gap:12,marginTop:16},children:[(0,s.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,s.jsx)("span",{children:"邮箱"}),(0,s.jsx)("input",{type:"email",value:t,onChange:e=>n(e.target.value),required:!0})]}),(0,s.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,s.jsx)("span",{children:"昵称（可选）"}),(0,s.jsx)("input",{value:u,onChange:e=>o(e.target.value),placeholder:"你的昵称"})]}),(0,s.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,s.jsx)("span",{children:"密码"}),(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[(0,s.jsx)("input",{type:g?"text":"password",value:d,onChange:e=>p(e.target.value),required:!0,style:{width:"100%"}}),(0,s.jsx)("button",{type:"button",onClick:()=>y(e=>!e),style:{fontSize:12,padding:"4px 8px",whiteSpace:"nowrap"},children:g?"隐藏密码":"显示密码"})]})]}),(0,s.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,s.jsx)("span",{children:"确认密码"}),(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[(0,s.jsx)("input",{type:f?"text":"password",value:c,onChange:e=>h(e.target.value),required:!0,style:{width:"100%"}}),(0,s.jsx)("button",{type:"button",onClick:()=>x(e=>!e),style:{fontSize:12,padding:"4px 8px",whiteSpace:"nowrap"},children:f?"隐藏密码":"显示密码"})]})]}),(0,s.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,s.jsx)("span",{children:"验证码"}),(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[(0,s.jsx)("input",{value:v,onChange:e=>S(e.target.value),required:!0,placeholder:"请输入右侧验证码",style:{width:"100%"}}),(0,s.jsx)("button",{type:"button",onClick:q,style:{padding:"4px 8px",fontFamily:"monospace",letterSpacing:2,cursor:"pointer",whiteSpace:"nowrap"},title:"点击更换验证码",children:m})]})]}),(0,s.jsx)("button",{type:"submit",disabled:b,children:b?"注册中...":"注册"}),w&&(0,s.jsx)("p",{style:{color:"red"},children:w}),R&&(0,s.jsx)("p",{style:{color:"green"},children:R})]}),"VERIFY"===I&&(0,s.jsxs)("form",{onSubmit:F,style:{display:"grid",gap:12,marginTop:24},children:[(0,s.jsxs)("p",{style:{fontSize:14,color:"#555"},children:["我们已向 ",(0,s.jsx)("strong",{children:P})," 发送了激活码，请填写邮箱中的 6 位数字激活码完成注册。"]}),(0,s.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,s.jsx)("span",{children:"激活码"}),(0,s.jsx)("input",{value:N,onChange:e=>_(e.target.value),placeholder:"请输入邮箱中的激活码",required:!0})]}),(0,s.jsx)("button",{type:"submit",disabled:b,children:b?"激活中...":"提交激活"}),w&&(0,s.jsx)("p",{style:{color:"red"},children:w}),R&&(0,s.jsx)("p",{style:{color:"green"},children:R})]}),(0,s.jsxs)("p",{style:{marginTop:16},children:["已有账号？ ",(0,s.jsx)(l.default,{href:"/login",children:"去登录"})]})]})}},7668:function(e,t,n){"use strict";function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,t="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz0123456789",n="";for(let s=0;s<e;s++){let e=Math.floor(Math.random()*t.length);n+=t[e]}return n}n.d(t,{y:function(){return s}})},7138:function(e,t,n){"use strict";n.d(t,{default:function(){return r.a}});var s=n(231),r=n.n(s)},6463:function(e,t,n){"use strict";var s=n(1169);n.o(s,"usePathname")&&n.d(t,{usePathname:function(){return s.usePathname}}),n.o(s,"useRouter")&&n.d(t,{useRouter:function(){return s.useRouter}}),n.o(s,"useSearchParams")&&n.d(t,{useSearchParams:function(){return s.useSearchParams}})}},function(e){e.O(0,[231,971,23,744],function(){return e(e.s=2884)}),_N_E=e.O()}]);