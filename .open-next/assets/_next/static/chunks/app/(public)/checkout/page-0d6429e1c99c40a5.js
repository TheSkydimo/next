(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[40],{6212:function(e,n,r){Promise.resolve().then(r.bind(r,749))},749:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return u}});var t=r(7437),s=r(2265),i=r(7648),a=r(9376);function l(){var e;let n=null!==(e=(0,a.useSearchParams)().get("planId"))&&void 0!==e?e:void 0,[r,l]=(0,s.useState)(!1),[u,o]=(0,s.useState)(null),[d,c]=(0,s.useState)(null),[h,f]=(0,s.useState)(null);async function p(){if(!n)return;let e=Number(n);if(!Number.isInteger(e)||e<=0){o("无效的套餐 ID");return}try{l(!0),o(null),c(null),f(null);let n=await fetch("/api/order/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({planId:e})});if(401===n.status){o("未登录，请先登录");return}let t=await n.json();if(!n.ok||"OK"!==t.code||!t.data){var r;o(null!==(r=t.message)&&void 0!==r?r:"创建订单失败，请稍后重试");return}c(t.data.orderNo),f(t.data.paymentUrl)}catch(e){o("网络错误，创建订单失败")}finally{l(!1)}}return(0,t.jsxs)("main",{style:{maxWidth:640,margin:"40px auto",padding:"0 16px"},children:[(0,t.jsx)("h1",{children:"结算页"}),!n&&(0,t.jsx)("p",{children:"请先在定价页选择一个套餐。"}),n&&(0,t.jsxs)("section",{style:{marginTop:16},children:[(0,t.jsxs)("div",{children:["当前选择的套餐 ID：",(0,t.jsx)("strong",{children:n})]}),(0,t.jsx)("button",{type:"button",style:{marginTop:16,padding:"8px 16px",borderRadius:4,border:"none",backgroundColor:"#000",color:"#fff",cursor:"pointer"},onClick:p,disabled:r,children:r?"创建订单中...":"确认下单"}),u&&(0,t.jsxs)("p",{style:{marginTop:12,color:"red"},children:[u,u.includes("未登录")&&(0,t.jsxs)(t.Fragment,{children:[" ",(0,t.jsx)(i.default,{href:"/login",children:"去登录"})]})]}),d&&(0,t.jsxs)("div",{style:{marginTop:16,lineHeight:1.8},children:[(0,t.jsxs)("div",{children:["订单已创建，订单号：",(0,t.jsx)("strong",{children:d})]}),(0,t.jsxs)("div",{children:["支付链接：",h?(0,t.jsx)("a",{href:h,target:"_blank",rel:"noreferrer",style:{color:"blue"},children:"点击前往支付"}):"暂未生成支付链接"]}),(0,t.jsxs)("div",{style:{marginTop:8},children:["你可以在"," ",(0,t.jsx)(i.default,{href:"/account/orders",style:{color:"blue"},children:"我的订单"})," ","中查看订单记录。"]})]})]})]})}function u(){return(0,t.jsx)(s.Suspense,{fallback:(0,t.jsxs)("main",{style:{maxWidth:640,margin:"40px auto",padding:"0 16px"},children:[(0,t.jsx)("h1",{children:"结算页"}),(0,t.jsx)("p",{children:"加载中..."})]}),children:(0,t.jsx)(l,{})})}},7648:function(e,n,r){"use strict";r.d(n,{default:function(){return s.a}});var t=r(2972),s=r.n(t)},9376:function(e,n,r){"use strict";var t=r(5475);r.o(t,"usePathname")&&r.d(n,{usePathname:function(){return t.usePathname}}),r.o(t,"useRouter")&&r.d(n,{useRouter:function(){return t.useRouter}}),r.o(t,"useSearchParams")&&r.d(n,{useSearchParams:function(){return t.useSearchParams}})}},function(e){e.O(0,[972,971,117,744],function(){return e(e.s=6212)}),_N_E=e.O()}]);