(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[606],{3074:function(t,d,e){Promise.resolve().then(e.bind(e,7130))},7130:function(t,d,e){"use strict";e.r(d),e.d(d,{default:function(){return i}});var n=e(7437),r=e(2265);function i(){let[t,d]=(0,r.useState)([]),[e,i]=(0,r.useState)(!0),[s,o]=(0,r.useState)(null),[l,a]=(0,r.useState)(null);async function c(t){if("REFUND_REQUESTED"===t.status&&window.confirm("确定要同意订单「".concat(t.orderNo,"」的退款申请吗？订单将标记为历史订单（已退款）。")))try{a(t.id),o(null);let n=await fetch("/api/admin/orders/".concat(t.id,"/refund"),{method:"POST"}),r=await n.json().catch(()=>({code:"UNKNOWN_ERROR"}));if(!n.ok||"OK"!==r.code){var e;o(null!==(e=r.message)&&void 0!==e?e:"同意退款失败");return}d(d=>d.map(d=>d.id===t.id?{...d,status:"REFUNDED"}:d))}catch(t){o("网络错误，同意退款失败")}finally{a(null)}}return(0,r.useEffect)(()=>{(async function(){try{var t,e;i(!0),o(null);let n=await fetch("/api/admin/orders");if(401===n.status||403===n.status){let d=await n.text();try{let e=JSON.parse(d);o(null!==(t=e.message)&&void 0!==t?t:"没有权限访问订单管理")}catch(t){o("没有权限访问订单管理")}return}let r=await n.json().catch(()=>({code:"UNKNOWN_ERROR"}));if(!n.ok||"OK"!==r.code||!r.data){o(null!==(e=r.message)&&void 0!==e?e:"获取订单列表失败");return}d(r.data)}catch(t){o("网络错误，获取订单列表失败")}finally{i(!1)}})()},[]),(0,n.jsxs)("section",{style:{maxWidth:960,margin:"24px auto",padding:"0 16px"},children:[(0,n.jsx)("h2",{children:"订单管理"}),s&&(0,n.jsx)("p",{style:{color:"red",marginTop:12},children:s}),e?(0,n.jsx)("p",{style:{marginTop:12},children:"加载中..."}):0===t.length?(0,n.jsx)("p",{style:{marginTop:12},children:"暂无订单数据。"}):(0,n.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:12,fontSize:14},children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{style:{borderBottom:"1px solid #ddd",padding:8},children:"ID"}),(0,n.jsx)("th",{style:{borderBottom:"1px solid #ddd",padding:8},children:"订单号"}),(0,n.jsx)("th",{style:{borderBottom:"1px solid #ddd",padding:8},children:"用户邮箱"}),(0,n.jsx)("th",{style:{borderBottom:"1px solid #ddd",padding:8},children:"套餐"}),(0,n.jsx)("th",{style:{borderBottom:"1px solid #ddd",padding:8},children:"金额"}),(0,n.jsx)("th",{style:{borderBottom:"1px solid #ddd",padding:8},children:"状态"}),(0,n.jsx)("th",{style:{borderBottom:"1px solid #ddd",padding:8},children:"时间"}),(0,n.jsx)("th",{style:{borderBottom:"1px solid #ddd",padding:8},children:"管理操作"})]})}),(0,n.jsx)("tbody",{children:t.map(t=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{style:{borderBottom:"1px solid #f0f0f0",padding:8,textAlign:"center"},children:t.id}),(0,n.jsx)("td",{style:{borderBottom:"1px solid #f0f0f0",padding:8,fontFamily:"monospace"},children:t.orderNo}),(0,n.jsx)("td",{style:{borderBottom:"1px solid #f0f0f0",padding:8},children:t.userEmail}),(0,n.jsx)("td",{style:{borderBottom:"1px solid #f0f0f0",padding:8},children:t.planName}),(0,n.jsxs)("td",{style:{borderBottom:"1px solid #f0f0f0",padding:8,textAlign:"center"},children:[t.amount," ",t.currency]}),(0,n.jsx)("td",{style:{borderBottom:"1px solid #f0f0f0",padding:8},children:function(t){switch(t){case"PENDING":return"待支付";case"PAID":return"已支付";case"CANCELED":return"已取消";case"REFUND_REQUESTED":return"退款申请中";case"REFUNDED":return"已退款（历史订单）";default:return t}}(t.status)}),(0,n.jsxs)("td",{style:{borderBottom:"1px solid #f0f0f0",padding:8},children:[(0,n.jsxs)("div",{children:["创建：",new Date(t.createdAt).toLocaleString()]}),t.paidAt&&(0,n.jsxs)("div",{style:{marginTop:2},children:["支付：",new Date(t.paidAt).toLocaleString()]})]}),(0,n.jsx)("td",{style:{borderBottom:"1px solid #f0f0f0",padding:8,textAlign:"center"},children:"REFUND_REQUESTED"===t.status?(0,n.jsx)("button",{type:"button",disabled:l===t.id,onClick:()=>void c(t),children:"同意退款"}):(0,n.jsx)("span",{style:{fontSize:12,color:"#999"},children:"无操作"})})]},t.id))})]})]})}}},function(t){t.O(0,[971,23,744],function(){return t(t.s=3074)}),_N_E=t.O()}]);