(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[366],{6935:function(e,t,i){Promise.resolve().then(i.bind(i,978))},978:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return a}});var n=i(7437),l=i(2265);let r={CNY:{label:"人民币（CNY）",toCNY:1},USD:{label:"美元（USD）",toCNY:7.2},EUR:{label:"欧元（EUR）",toCNY:7.8}};function d(e){return e.toFixed(2)}let s={name:"",price:99,currency:"CNY",billingCycle:"MONTHLY",description:"",isActive:!0};function a(){var e;let[t,i]=(0,l.useState)([]),[a,c]=(0,l.useState)(!0),[o,p]=(0,l.useState)(null),[u,h]=(0,l.useState)(s),[x,y]=(0,l.useState)(!1),[f,m]=(0,l.useState)(null),[g,j]=(0,l.useState)(!1);async function b(){try{var e,t;c(!0),p(null);let n=await fetch("/api/admin/membership/plans");if(401===n.status||403===n.status){let t=await n.text();try{let i=JSON.parse(t);p(null!==(e=i.message)&&void 0!==e?e:"没有权限访问套餐管理")}catch(e){p("没有权限访问套餐管理")}return}let l=await n.json();if(!n.ok||"OK"!==l.code||!l.data){p(null!==(t=l.message)&&void 0!==t?t:"获取套餐列表失败");return}i(l.data)}catch(e){p("网络错误，获取套餐列表失败")}finally{c(!1)}}function v(e,t){h(i=>({...i,[e]:t}))}async function C(e){e.preventDefault();try{y(!0),p(null);let e=Number(u.price),i=await fetch("/api/admin/membership/plans",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:u.name,price:Math.round(100*e),currency:u.currency,billingCycle:u.billingCycle,description:u.description||void 0,isActive:u.isActive})}),n=await i.json().catch(()=>({}));if(!i.ok||"OK"!==n.code||!n.data){var t;p(null!==(t=n.message)&&void 0!==t?t:"创建套餐失败");return}h(s),await b()}catch(e){p("网络错误，创建套餐失败")}finally{y(!1)}}async function N(e){try{m(e.id),p(null);let n=await fetch("/api/admin/membership/plans/".concat(e.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:!e.isActive})}),l=await n.json().catch(()=>({}));if(!n.ok||"OK"!==l.code||!l.data){var t;p(null!==(t=l.message)&&void 0!==t?t:"更新套餐状态失败");return}i(t=>t.map(t=>t.id===e.id?{...t,isActive:!t.isActive}:t))}catch(e){p("网络错误，更新套餐状态失败")}finally{m(null)}}async function T(e){if(window.confirm("确定要删除套餐「".concat(e.name,"」吗？")))try{m(e.id),p(null);let n=await fetch("/api/admin/membership/plans/".concat(e.id),{method:"DELETE"}),l=await n.json().catch(()=>({}));if(!n.ok||"OK"!==l.code){var t;p(null!==(t=l.message)&&void 0!==t?t:"删除套餐失败");return}i(t=>t.filter(t=>t.id!==e.id))}catch(e){p("网络错误，删除套餐失败")}finally{m(null)}}return(0,l.useEffect)(()=>{b()},[]),(0,n.jsxs)("section",{style:{maxWidth:960,margin:"24px auto",padding:"0 16px"},children:[(0,n.jsx)("h2",{children:"套餐管理"}),o&&(0,n.jsx)("p",{style:{color:"red",marginTop:12},children:o}),a?(0,n.jsx)("p",{style:{marginTop:12},children:"加载中..."}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("section",{style:{marginTop:16},children:[(0,n.jsx)("h3",{children:"已有套餐"}),0===t.length&&(0,n.jsx)("p",{style:{marginTop:8},children:"当前没有任何套餐。"}),t.length>0&&(0,n.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:8,fontSize:14},children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{style:{borderBottom:"1px solid #ddd",padding:8},children:"ID"}),(0,n.jsx)("th",{style:{borderBottom:"1px solid #ddd",padding:8},children:"名称"}),(0,n.jsx)("th",{style:{borderBottom:"1px solid #ddd",padding:8},children:"价格"}),(0,n.jsx)("th",{style:{borderBottom:"1px solid #ddd",padding:8},children:"周期"}),(0,n.jsx)("th",{style:{borderBottom:"1px solid #ddd",padding:8},children:"状态"}),(0,n.jsx)("th",{style:{borderBottom:"1px solid #ddd",padding:8},children:"操作"})]})}),(0,n.jsx)("tbody",{children:t.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{style:{borderBottom:"1px solid #f0f0f0",padding:8,textAlign:"center"},children:e.id}),(0,n.jsx)("td",{style:{borderBottom:"1px solid #f0f0f0",padding:8},children:e.name}),(0,n.jsxs)("td",{style:{borderBottom:"1px solid #f0f0f0",padding:8},children:[e.price/100," ",e.currency]}),(0,n.jsx)("td",{style:{borderBottom:"1px solid #f0f0f0",padding:8,textAlign:"center"},children:function(e){switch(e){case"MONTHLY":return"按月";case"QUARTERLY":return"按季度";case"YEARLY":return"按年";default:return e}}(e.billingCycle)}),(0,n.jsx)("td",{style:{borderBottom:"1px solid #f0f0f0",padding:8,textAlign:"center"},children:e.isActive?"已启用":"已停用"}),(0,n.jsxs)("td",{style:{borderBottom:"1px solid #f0f0f0",padding:8,textAlign:"center"},children:[(0,n.jsx)("button",{type:"button",onClick:()=>void N(e),disabled:f===e.id,style:{marginRight:8},children:e.isActive?"停用":"启用"}),(0,n.jsx)("button",{type:"button",onClick:()=>void T(e),disabled:f===e.id,style:{color:"red"},children:"删除"})]})]},e.id))})]})]}),(0,n.jsxs)("section",{style:{marginTop:24},children:[(0,n.jsx)("h3",{children:"新建套餐"}),(0,n.jsxs)("form",{onSubmit:e=>void C(e),style:{marginTop:12,display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:12,alignItems:"flex-end"},children:[(0,n.jsxs)("label",{style:{display:"flex",flexDirection:"column"},children:[(0,n.jsx)("span",{children:"名称"}),(0,n.jsx)("input",{type:"text",value:u.name,onChange:e=>v("name",e.target.value),required:!0})]}),(0,n.jsxs)("label",{style:{display:"flex",flexDirection:"column"},children:[(0,n.jsx)("span",{children:"价格（元）"}),(0,n.jsx)("input",{type:"number",value:u.price,onChange:e=>v("price",Number(e.target.value)),min:0,step:.01,required:!0})]}),(0,n.jsxs)("label",{style:{display:"flex",flexDirection:"column"},children:[(0,n.jsx)("span",{children:"币种"}),(0,n.jsx)("select",{value:u.currency,onChange:e=>{var t;return t=e.target.value,void h(e=>{let i=r[e.currency],n=r[t];if(!i||!n||e.price<=0)return{...e,currency:t};let l=e.price*i.toCNY/n.toCNY;return{...e,currency:t,price:Math.round(100*l)/100}})},disabled:!0,required:!0,children:(0,n.jsx)("option",{value:"CNY",children:"人民币（CNY）"})})]}),(0,n.jsxs)("label",{style:{display:"flex",flexDirection:"column"},children:[(0,n.jsx)("span",{children:"计费周期"}),(0,n.jsxs)("select",{value:u.billingCycle,onChange:e=>v("billingCycle",e.target.value),children:[(0,n.jsx)("option",{value:"MONTHLY",children:"按月"}),(0,n.jsx)("option",{value:"QUARTERLY",children:"按季度"}),(0,n.jsx)("option",{value:"YEARLY",children:"按年"})]})]}),(0,n.jsxs)("label",{style:{display:"flex",flexDirection:"column"},children:[(0,n.jsx)("span",{children:"描述"}),(0,n.jsx)("input",{type:"text",value:null!==(e=u.description)&&void 0!==e?e:"",onChange:e=>v("description",e.target.value)})]}),(0,n.jsxs)("label",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:4},children:[(0,n.jsx)("input",{type:"checkbox",checked:u.isActive,onChange:e=>v("isActive",e.target.checked)}),(0,n.jsx)("span",{children:"创建后立即启用"})]}),(0,n.jsx)("button",{type:"submit",disabled:x,style:{padding:"6px 12px"},children:x?"创建中...":"创建套餐"}),u.price>0&&(0,n.jsxs)("div",{style:{gridColumn:"1 / -1",fontSize:12,color:"#666",borderTop:"1px dashed #ddd",paddingTop:8,marginTop:4},children:[(0,n.jsxs)("button",{type:"button",onClick:()=>j(e=>!e),style:{padding:0,border:"none",background:"none",cursor:"pointer",fontSize:12,color:"#666",display:"flex",alignItems:"center",gap:4},children:[(0,n.jsx)("span",{children:g?"收起汇率参考价":"展开汇率参考价（约）"}),(0,n.jsx)("span",{style:{fontSize:10},children:g?"▲":"▼"})]}),g&&(0,n.jsx)("div",{style:{marginTop:4,lineHeight:1.6},children:(function(e,t){let i=r.CNY;if(!i||e<=0)return[];let n=e*i.toCNY,l=[];return Object.keys(r).forEach(e=>{let t=n/r[e].toCNY;l.push({code:e,value:parseFloat(d(t))})}),l})(u.price,0).map(e=>{var t,i;return(0,n.jsxs)("div",{children:[null!==(i=null===(t=r[e.code])||void 0===t?void 0:t.label)&&void 0!==i?i:e.code,"：",d(e.value)," ",e.code]},e.code)})})]})]})]})]})]})}}},function(e){e.O(0,[971,23,744],function(){return e(e.s=6935)}),_N_E=e.O()}]);