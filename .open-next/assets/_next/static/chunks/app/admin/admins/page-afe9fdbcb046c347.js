(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[111],{5193:function(t,d,e){Promise.resolve().then(e.bind(e,8928))},8928:function(t,d,e){"use strict";e.r(d),e.d(d,{default:function(){return l}});var i=e(7437),n=e(2265);function l(){let[t,d]=(0,n.useState)([]),[e,l]=(0,n.useState)(!0),[o,r]=(0,n.useState)(null),[s,a]=(0,n.useState)(null);async function c(t){if(window.confirm("确定要将管理员「".concat(t.email,"」改为普通用户吗？此操作会影响其后台访问权限。")))try{a(t.id),r(null);let i=await fetch("/api/admin/users/".concat(t.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:"USER"})}),n=await i.json().catch(()=>({}));if(!i.ok||"OK"!==n.code||!n.data){var e;r(null!==(e=n.message)&&void 0!==e?e:"更新管理员角色失败");return}d(d=>d.filter(d=>d.id!==t.id))}catch(t){r("网络错误，更新管理员角色失败")}finally{a(null)}}return(0,n.useEffect)(()=>{(async function(){try{var t,e;l(!0),r(null);let i=await fetch("/api/admin/admins");if(401===i.status||403===i.status){let d=await i.text();try{let e=JSON.parse(d);r(null!==(t=e.message)&&void 0!==t?t:"没有权限访问管理员管理")}catch(t){r("没有权限访问管理员管理")}return}let n=await i.json().catch(()=>({}));if(!i.ok||"OK"!==n.code||!n.data){r(null!==(e=n.message)&&void 0!==e?e:"获取管理员列表失败");return}d(n.data)}catch(t){r("网络错误，获取管理员列表失败")}finally{l(!1)}})()},[]),(0,i.jsxs)("section",{style:{maxWidth:960,margin:"24px auto",padding:"0 16px"},children:[(0,i.jsx)("h2",{children:"管理员信息管理"}),o&&(0,i.jsx)("p",{style:{color:"red",marginTop:12},children:o}),e?(0,i.jsx)("p",{style:{marginTop:12},children:"加载中..."}):0===t.length?(0,i.jsx)("p",{style:{marginTop:12},children:"当前没有管理员账号。"}):(0,i.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:12,fontSize:14},children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{style:{borderBottom:"1px solid #ddd",padding:8},children:"ID"}),(0,i.jsx)("th",{style:{borderBottom:"1px solid #ddd",padding:8},children:"邮箱"}),(0,i.jsx)("th",{style:{borderBottom:"1px solid #ddd",padding:8},children:"姓名"}),(0,i.jsx)("th",{style:{borderBottom:"1px solid #ddd",padding:8},children:"注册时间"}),(0,i.jsx)("th",{style:{borderBottom:"1px solid #ddd",padding:8},children:"最近更新"}),(0,i.jsx)("th",{style:{borderBottom:"1px solid #ddd",padding:8},children:"管理操作"})]})}),(0,i.jsx)("tbody",{children:t.map(t=>{var d;return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{borderBottom:"1px solid #f0f0f0",padding:8,textAlign:"center"},children:t.id}),(0,i.jsx)("td",{style:{borderBottom:"1px solid #f0f0f0",padding:8},children:t.email}),(0,i.jsx)("td",{style:{borderBottom:"1px solid #f0f0f0",padding:8},children:null!==(d=t.name)&&void 0!==d?d:"未设置"}),(0,i.jsx)("td",{style:{borderBottom:"1px solid #f0f0f0",padding:8},children:new Date(t.createdAt).toLocaleString()}),(0,i.jsx)("td",{style:{borderBottom:"1px solid #f0f0f0",padding:8},children:new Date(t.updatedAt).toLocaleString()}),(0,i.jsx)("td",{style:{borderBottom:"1px solid #f0f0f0",padding:8,textAlign:"center"},children:(0,i.jsx)("button",{type:"button",disabled:s===t.id,onClick:()=>void c(t),children:"设为普通用户"})})]},t.id)})})]})]})}}},function(t){t.O(0,[971,117,744],function(){return t(t.s=5193)}),_N_E=t.O()}]);